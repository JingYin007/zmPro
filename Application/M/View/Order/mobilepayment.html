<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <title>联系信息</title>
    <link href="__MCSS__/admin.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="__MJS__/jquery-1.8.0.min.js"></script>

    <script type="text/javascript" src="__MJS__/order.js"></script>
    <script type="text/javascript" src="__MJS__/dialog/layer.js"></script>
    <script type="text/javascript" src="__MJS__/dialog.js"></script>
</head>
<style>
    .wxDialog,.wxdia{
        margin-top: 33px;
    }
</style>
<body class="grzxbjk">
<form action="{:U('Cartpay/alipay')}" id="form-mobile" method="post">
    <div class="srmtop">填写收货信息</div>
    <div class="singzhms yjtpbh order-input">
        <input name="consignee" id="consignee" type="text" placeholder="收货人姓名"/>
    </div>
    <div class="singzhms yjtpbh order-input">
        <input name="mobile" id="mobile" type="number" placeholder = "收货人手机号"/>
    </div>
    <div class="singzhms yjtpbh order-input">
        <input name="city1" id="city1" type="text" placeholder="省份/城市/区县"/>
    </div>
    <div class="singzhms yjtpbh order-input">
        <input name="city2" id="city2" type="text" placeholder="详细地址，如街道、门牌号等"/>
    </div>
    <input type="hidden" name="order_sn" value="{$res.order_sn}"/>
    <input type="hidden" name="pay_type" id="pay_type" value="none"/>
</form>
<div class="srmtop">选择支付方式</div>
<div class="zfxzfs">
    <p onclick="selRadio('ali')">
        <button type="radio" class="btnRadio btn-ali" name="TR">◉</button>
        <img src="__MIMG__/26.jpg" />
    </p>
    <p onclick="selRadio('wx')">
        <button type="radio" class="btnRadio btn-wx" name="TR" >◉</button>
        <img src="__MIMG__/22.jpg" />
    </p>
</div>
<div class="dlzcan" onclick="nextToPay()">
    <input name="" type="button" value="下一步"/>
</div>
<div class="wxDialog" style="display: none;">
    <center>
        <div class="wxdia">
            <img src="{:U('Order/wechatpaymenter',array('order_sn'=>$res['order_sn']))}" style="width:150px;height:150px;" />
        </div>
    </center>
</div>
</body>
<script>
    var btn  = document.getElementsByTagName("button");
    for(var i=0;i<btn.length;i++){
        (function(index){
            btn[index].onclick = function(){
                if(btn[index].style.color === "red"){
                    btn[index].style.color = "";
                }else{
                    btn[index].style.color = "red";
                }
            }
        }(i))
    }

    function selRadio(type) {
        var pay_type = $('#pay_type').val(type);
        var selTag = redBtnTag($(".btn-"+type));
        $(".btnRadio").css("color","");
        if (selTag){
            $(".btn-"+type).css('color',"red")
        }
    }
    function nextToPay() {
        var pay_type = $('#pay_type').val();
        var toUrl = "{:U('Order/ajax_deal_orderSn')}";
        if (pay_type == 'none'){
            layer.msg('请选择支付方式',{'time':1000});
        }else if (pay_type == 'wx'){
            if (checkInputMsg()){
                $.post(
                        toUrl,
                        $("#form-mobile").serialize(),
                        function (result) {
                            if(result.status != 1){
                                layer.msg(result.message);
                            }else {
                                layer.msg('支付功能开发中...',{'time':1000});
                                //$(".wxDialog").show();
                            }
                        },"JSON");

            }

            //layer.msg('支付功能开发中...',{'time':1000});
        } else {
            if (checkInputMsg()){
                $.post(
                        toUrl,
                        $("#form-mobile").serialize(),
                        function (result) {
                            if(result.status != 1){
                                layer.msg(result.message);
                                //layer.msg('支付功能开发中...',{'time':1000});
                            }else {
                                $("#form-mobile").submit();
                            }
                        },"JSON");

            }
            //layer.msg('支付功能开发中...',{'time':1000})
        }
    }
    function checkInputMsg() {
        var flag,flag1,flag2,flag3;
        flag = noMsgTip($("#city2"));
        flag1 = noMsgTip($("#city1"));
        flag2 = noMsgTip($("#mobile"));
        flag3 = noMsgTip($("#consignee"));
        if(flag && flag1 && flag2 && flag3){
            return true;
        }else {
            return false;
        }

    }
    function noMsgTip(tag) {
        var msg = tag.val();
        var tip =tag.attr('placeholder');
        var phoneNumReg = /^1(3|4|5|7|8)\d{9}$/;
        if (msg == '' || msg.length == 0){
            layer.msg('请输入'+tip,{'time':1000});
            return false;
        }else {
            if (tag.attr('name') == 'mobile'){
                if (!phoneNumReg.test(msg)){
                    layer.msg('请输入正确的手机号码!',{time:1500});
                    return false;
                }
            }
            return true;
        }
    }
</script>
</html>