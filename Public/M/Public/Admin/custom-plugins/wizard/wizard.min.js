/*
 * MoonCake v1.3.1 - Wizard Plugin
 *
 * This file is part of MoonCake, an Admin template build for sale at ThemeForest.
 * For questions, suggestions or support request, please mail me at maimairel@yahoo.com
 *
 * Development Started:
 * July 28, 2012
 * Last Update:
 * December 07, 2012
 *
 * 'Highly configurable' mutable plugin boilerplate
 * Author: @markdalgleish
 * Further changes, comments: @addyosmani
 * Licensed under the MIT license
 *
 */

;(function(c,k,l,j){var h=function(a,b){arguments.length&&this._init(a,b)};h.prototype={defaults:{element:".wizard-step",navLabelElement:".wizard-label",navContainerClass:"wizard-nav",buttonContainerClass:"form-actions btn-toolbar",defaultButtonClass:"btn",responsiveNextButtonClass:"responsive-next-btn",responsivePrevButtonClass:"responsive-prev-btn",submitButtonClass:"btn-primary pull-right",responsiveNextButtonLabel:'<i class="icon-caret-right"></i>',responsivePrevButtonLabel:'<i class="icon-caret-left"></i>',
nextButtonLabel:"Next",prevButtonLabel:"Prev",submitButtonLabel:"Submit",submitButtonName:"wizard-submit",forwardOnly:!1,orientation:"horizontal",onStepLeave:null,onStepShown:null,onBeforeSubmit:null,ajaxSubmit:!1,ajaxOptions:{}},_init:function(a,b){this.element=c(a);this.options=c.extend({},this.defaults,b,this.element.data());this._activeWzdId=-1;this._navigationLocked=!1;this._activatedSteps=[];this._parseOptions();this.steps=this.element.find(this.options.element);this.steps.hide();this.nav=this._buildNavigation(this.steps);
this.buttons=this._buildButtons();this._bindEvents();this._navigate(this.steps.eq(0).data("wzd-id"),!0)},_parseOptions:function(){if(this.options.ajaxSubmit&&c.fn.ajaxSubmit){var a=this.options.ajaxOptions.success,b=this.options.ajaxOptions.complete,d=this.options.ajaxOptions.error,e=this.options.ajaxOptions.beforeSend,g=this.options.ajaxOptions.beforeSubmit,f=this.options.ajaxOptions.beforeSerialize;this.options.ajaxOptions=c.extend({},this.options.ajaxOptions,{success:function(b,d,g,e){c.isFunction(a)&&
a.call(this,b,d,g,e)},complete:function(a,d){c.isFunction(b)&&b.call(this,a,d)},error:function(a,b){c.isFunction(d)&&d.call(this,a,b)},beforeSubmit:function(a,b,d){return c.isFunction(g)?g.call(this,a,b,d):!0},beforeSend:function(a){return c.isFunction(e)?e.call(this,a):!0},beforeSerialize:function(a,b){return c.isFunction(f)?f.call(this,a,b):!0}});this.element.ajaxForm(this.options.ajaxOptions)}c.inArray(this.options.orientation,["horizontal","vertical"])||(this.options.orientation="horizontal");
this.element.addClass("wizard-form wizard-form-"+this.options.orientation)},_callFunction:function(a,b){return!c.isFunction(a)?!0:a.apply(this,b)},_generateRandomId:function(){var a=(new Date).getTime().toString(32),b;for(b=0;3>b;b++)a+=Math.floor(65535*Math.random()).toString(32);return"wzd_"+a},_buildNavigation:function(a){var b=c('<div class="'+this.options.navContainerClass+" "+this.options.navContainerClass+"-"+this.options.orientation+'"></div>'),d=c("<ul></ul>"),e=this._generateRandomId();
c.each(a,c.proxy(function(a,b){var h=c("<li><span></span></li>"),i=c(b).find(this.options.navLabelElement).hide();h.find("span").html(i&&i.length?i.html():"Step "+a).end().appendTo(d).add(b).attr("data-wzd-id",e+"_"+a)},this));return b.append(d).insertBefore(this.element)},_buildButtons:function(){var a=c('<div class="'+this.options.buttonContainerClass+'"></div>'),b=c('<button type="button"></button>').addClass(this.options.defaultButtonClass),d=b.clone().addClass(this.options.prevButtonClass).text(this.options.prevButtonLabel),
e=b.clone().addClass(this.options.responsivePrevButtonClass).html(this.options.responsivePrevButtonLabel),g=b.clone().addClass(this.options.nextButtonClass).text(this.options.nextButtonLabel),f=b.clone().addClass(this.options.responsiveNextButtonClass).html(this.options.responsiveNextButtonLabel),b=b.clone().addClass(this.options.submitButtonClass).text(this.options.submitButtonLabel).attr("name",this.options.submitButtonName);this.nav&&this.nav.length&&this.nav.append([e,f]);a.append([d,g,b]).appendTo(this.element);
return{prev:d,next:g,responsivePrev:e,responsiveNext:f,submit:b}},_refreshButtons:function(){this.buttons.prev.add(this.buttons.responsivePrev).attr("disabled",this._isFirstStep(this._activeWzdId)||this.options.forwardOnly);this.buttons.next.add(this.buttons.responsiveNext).attr("disabled",this._isLastStep(this._activeWzdId));this.buttons.submit.toggle(this._isLastStep(this._activeWzdId))},_bindEvents:function(){var a=this;this.nav.on("click.wizard","li",function(b){a._navigate(c(this).data("wzd-id"));
b.preventDefault()});this.buttons.prev.add(this.buttons.responsivePrev).on("click.wizard",function(b){a.prev();b.preventDefault()});this.buttons.next.add(this.buttons.responsiveNext).on("click.wizard",function(b){a.next();b.preventDefault()});this.buttons.submit.on("click.wizard",function(b){a.submitForm();b.preventDefault()})},_canNavigate:function(a){var a=this._findStep(a),b=this._findStep(this._activeWzdId);return!this._navigationLocked&&!(this.options.forwardOnly&&a&&b&&a.index()<=b.index())},
_stepActivated:function(a){return this._validWzdId(a)&&-1<c.inArray(a,this._activatedSteps)},_activateStep:function(a){if(this._validWzdId(a)){for(var b=this._findNav(a).index(),d=0;d<b;++d)if(-1===c.inArray(this.steps.eq(d).data("wzd-id"),this._activatedSteps))return;-1===c.inArray(a,this._activatedSteps)&&this._activatedSteps.push(a)}},_findStep:function(a){return this.steps.filter('[data-wzd-id="'+a+'"]').first()},_findNav:function(a){return this.nav.find("li").filter('[data-wzd-id="'+a+'"]').first()},
_navigate:function(a,b){if(this._validWzdId(a)&&(b||this._canNavigate(a)&&this._callFunction(this.options.onStepLeave,[this,this._findStep(this._activeWzdId)[0]])))this._activateStep(a),this._showStep(a)},_showStep:function(a){if(this._validWzdId(a))if(-1===this._activeWzdId)this.steps.hide(),this._findStep(a).show(),this._updateNav(a),this._activeWzdId=a,this._refreshButtons();else if(a!==this._activeWzdId&&this._stepActivated(a)){var b=this._findStep(this._activeWzdId),c=this;this._navigationLocked=
!0;b.fadeOut("fast",function(){c._updateNav(a);var b=c._findStep(a);b.fadeIn("fast",function(){c._activeWzdId=a;c._navigationLocked=!1;c._refreshButtons();c._callFunction(c.options.onStepShown,[c,b])})})}},_updateNav:function(a){this._validWzdId(a)&&this._findNav(a).siblings("li").removeClass("current").end().addClass("current")},_isLastStep:function(a){return this._validWzdId(a)&&a===this.steps.last().data("wzd-id")},_isFirstStep:function(a){return this._validWzdId(a)&&a===this.steps.first().data("wzd-id")},
_validWzdId:function(a){return"string"===typeof a&&0===a.indexOf("wzd_")},next:function(){this._isLastStep(this._activeWzdId)||this._navigate(this._findStep(this._activeWzdId).next().data("wzd-id"))},prev:function(){this._isFirstStep(this._activeWzdId)||this._navigate(this._findStep(this._activeWzdId).prev().data("wzd-id"))},submitForm:function(){this._callFunction(this.options.onBeforeSubmit,[this,this.element])&&this.element.submit()},reset:function(){this._activatedSteps=[];this._activeWzdId=-1;
this.steps.hide();c.fn.clearForm&&this.element.clearForm();this._navigate(this.steps.eq(0).data("wzd-id"),!0)}};c.fn.wizard=function(a){var b="string"===typeof a,d=Array.prototype.slice.call(arguments,1),e=this;if(b&&"_"===a.charAt(0))return e;b?this.each(function(){var b=c.data(this,"wizard"),f=b&&c.isFunction(b[a])?b[a].apply(b,d):b;if(f!==b&&f!==j)return e=f,!1}):this.each(function(){c.data(this,"wizard")||c.data(this,"wizard",new h(this,a))});return e}})(jQuery,window,document);